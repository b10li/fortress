import util.utilEud;
import header;
import customText3 as ct; 




function isSelecting()
{
    if(Bring($Force1, AtLeast, 1, header.Flag, $L('preTurn')+1)
        || Bring($Force3, AtLeast, 1, header.Flag, $L('preTurn')+1))
        return 1;
    else
        return 0;
}

function getSelection(targetPlayer)
{
    const selectedUnitEpd = dwread_epd_safe(EPD(0x6284E8 + 48*targetPlayer));
    if(selectedUnitEpd != 0)
    {
        const unitType = utilEud.getUnitType(EPD(selectedUnitEpd));
        return unitType;
    }
    else
        return 0;
}

function showTankInfo(unitType, targetPlayer)
{
    //None
   
    if (unitType == 0)
    {
        const chatPtr = dwread_epd(EPD(0x640B58));
        ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
        ct.printP(targetPlayer, "\x13원하는 탱크를 마우스로 클릭해주세요");
        dwwrite_epd(EPD(0x640B58), chatPtr);
    }
    else
    {
        const chatPtr = dwread_epd(EPD(0x640B58));
        //Dragoon
        if(unitType == header.Dragoon)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07빡탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01길 못찾음");
        }
        //Reaver
        else if(unitType == header.Reaver)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07립탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01기어다님");
        }
        //Ursadon
        else if(unitType == header.Ursadon)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07곰탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01귀여움");
        }
        //Darchon
        else if(unitType == header.Darchon)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07빡탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01당하면 화남");
        }
        //Devourer
        else if(unitType == header.Devourer)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07딥탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03문제: \x01디바가 울면?");
        }
        //Tank
        else if(unitType == header.Tank)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07탱크\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01시즈 못함");
        }
        //Goliath
        else if(unitType == header.Goliath)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07골탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01길 못찾음");
        }
        //Vulture
        else if(unitType == header.Vulture)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07벌탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01마인 시벌탱");
        }
        //Lurker
        else if(unitType == header.Lurker)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07럴탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■■□");
            ct.printP(targetPlayer, "\x03특징: \x01숨어있음");
        }
        //Ultralisk
        else if(unitType == header.Ultralisk)
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13[ \x07울탱\x01 ]");
            ct.printP(targetPlayer, "\x13공격: \x08■■■□□");
            ct.printP(targetPlayer, "\x03상식: \x01돼지는 하늘을 못본다");
        }
        else 
        {
            ct.printP(targetPlayer, ""); // ct.cp는 모두에게 출력
            ct.printP(targetPlayer, "\x13유닛을 마우스로 선택해주세요");
        }
        ct.printP(targetPlayer, "");
        ct.printP(targetPlayer, "\x13\x07[ L ] : \x01선택");
        dwwrite_epd(EPD(0x640B58), chatPtr);
    }
    return unitType;
}

function isListed(unitType)
{
    for(var i=0; i<10; i++)
    {
        if(header.List[i] == unitType) return 1;
    }
    return 0;
}

function selectScreen()
{
    EUDPlayerLoop()();
    const i = getcurpl();
    if(i<6)
    {
        //Flag
        if(Command(i, Exactly, 1, header.Flag))
        {
            const key = utilEud.getDeath(i, 0);
            CenterView($L('select')+1);
            const unitType = showTankInfo(getSelection(i), i);

            if(key == 8 && isListed(unitType)) // L
            {// confirm
                RemoveUnit(header.Flag, i);
                //save selection 
                SetDeaths(i, SetTo, unitType, header.tankType);
            }

        }
    }
    EUDEndPlayerLoop();
}
